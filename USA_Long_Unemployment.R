################################################################################
##### MOVING AVERAGE (1) MODEL #################################################
################################################################################

{
  usaufitLR <- dynlm(usa_u ~  usa_cpi + usa_cpi_1)
  summary(usaufitLR)
}

################################################################################
##### AUTOREGRESSIVE (1) MODEL #################################################
################################################################################

{
  ARusaufitLR <- dynlm(usa_u ~  usa_cpi + usa_u_1)
  summary(ARusaufitLR)
}

################################################################################
##### AUTOREGRESSIVE MOVING AVERAGE (1,1) MODEL ################################
################################################################################

{
  ARMAusaufitLR <- dynlm(usa_u ~  usa_cpi + usa_u_1 + usa_cpi_1)
  summary(ARMAusaufitLR)
}

################################################################################
##### AUTOREGRESSIVE MOVING AVERAGE (2,2) MODEL ################################
################################################################################

{
  ARMA2usaufitLR <- dynlm(usa_u ~  usa_cpi + usa_u_1 + usa_cpi_1 + usa_u_2 + usa_cpi_2)
  summary(ARMA2usaufitLR)
}

################################################################################
##### AUTOREGRESSIVE MOVING AVERAGE (2,1) MODEL ################################
################################################################################

{
  ARMA21usaufitLR <- dynlm(usa_u ~  usa_cpi + usa_u_1 + usa_cpi_1 + usa_u_2 )
  summary(ARMA21usaufitLR)
}

################################################################################
##### AUTOREGRESSIVE MOVING AVERAGE (1,2) MODEL ################################
################################################################################

{
  ARMA12usaufitLR <- dynlm(usa_u ~  usa_cpi + usa_u_1 + usa_cpi_1 + usa_cpi_2 )
  summary(ARMA12usaufitLR)
}

################################################################################
##### AUTOREGRESSIVE (2) MODEL #################################################
################################################################################

{
  AR2usaufitLR <- dynlm(usa_u ~  usa_cpi + usa_u_1 + usa_u_2)
  summary(AR2usaufitLR)
}

################################################################################
##### SELECTING BEST MODEL #####################################################
################################################################################

AIC(usaufitLR, ARusaufitLR, ARMAusaufitLR)
AIC(ARMA2usaufitLR, ARMA21usaufitLR, ARMA12usaufitLR)
AIC(AR2usaufitLR)
BIC(usaufitLR, ARusaufitLR, ARMAusaufitLR)
BIC(ARMA2usaufitLR, ARMA21usaufitLR, ARMA12usaufitLR)
BIC(AR2usaufitLR)

#we choose ARMA(2,1) for the information criteria

################################################################################
##### HETEROSKEDASTICITY TEST ##################################################
################################################################################

bptest(ARMA21usaufitLR, studentize = FALSE) #RIFUTO H0 -> Eteroschedasticità

################################################################################
##### ARCH TEST ################################################################
################################################################################

archTestusa_u_LR<- ArchTest(ARMA21usaufitLR$residuals, lags=2, demean=FALSE)
archTestusa_u_LR

################################################################################
##### F-STATISTIC DISTRIBUTION TEST ############################################
################################################################################

resettest(usa_u ~  usa_cpi + usa_u_1 +usa_u_2+ usa_cpi_1 ) #ACCETTO H0 -> Non ho bisognon di termini di y^2,...

################################################################################
##### WALD TEST ################################################################
################################################################################

wald.test(Sigma = vcov(ARMA21usaufitLR), b = coef(ARMA21usaufitLR), Terms = 2:5)

################################################################################
##### DURBIN-WATSON TEST #######################################################
################################################################################

dwtest(ARMA21usaufitLR)
Box.test(ARMA21usaufitLR$residuals, type = "Ljung-Box", lag = 6)
Box.test(ARMA21usaufitLR$residuals, type = "Box-Pierce", lag = 6) 

{
  X11()
  acf(ARMA21usaufitLR$residuals)
}


